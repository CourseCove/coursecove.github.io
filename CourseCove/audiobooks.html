<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Audiobooks | CourseCove</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/style.css" />
<link rel="icon" type="image/png" href="images/favicon.png" />
<style>
  body { font-family: 'Inter', sans-serif; background-color: #f4f7fb; margin:0; padding: 1.5rem;}
  header { text-align:center; margin:20px 0; }
  header h1 { font-size:2.5rem; color:#333; margin:0; }
  header p { font-size:1.125rem; color:#666; }
  .filters { display:flex; justify-content:center; margin:20px 0; gap:20px; flex-wrap:wrap; }
  select, input[type="text"] { padding:10px; border-radius:8px; border:1px solid #ddd; font-size:1rem; width:200px; }
  #loading { text-align:center; margin:20px; color:#666; }
  .card-body { display: flex; flex-direction: column; justify-content: space-between; }
  .card-title { font-size: 1.125rem; font-weight: bold; }
  .card-text { font-size: 0.875rem; color: #555; }
  .btn { margin-top: auto; }
</style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-expand-lg" style="background-color: #e3e5e9;">
  <div class="container">
    <a class="navbar-brand" href="../index.html">
      <img src="images/logo1.png" alt="Course Aggregator Logo" style="height: 70px; width: auto;" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="math.html">Math</a></li>
        <li class="nav-item"><a class="nav-link" href="ai-ml.html">AI / ML</a></li>
        <li class="nav-item"><a class="nav-link" href="arts-humanities.html">Arts & Humanities</a></li>
        <li class="nav-item"><a class="nav-link" href="languages.html">Languages</a></li>
        <li class="nav-item"><a class="nav-link" href="politics-economics.html">Politics & Economics</a></li>
        <li class="nav-item"><a class="nav-link" href="environment.html">Environment</a></li>
        <li class="nav-item"><a class="nav-link" href="../blog.html">Blog</a></li>
        <li class="nav-item"><a class="nav-link" href="books.html">Books</a></li>
        <li class="nav-item"><a class="nav-link active" href="#">Audiobooks</a></li>
        <li class="nav-item"><a class="nav-link" href="articles.html">Articles</a></li>
        <li class="nav-item"><a class="nav-link" href="citation.html">Citation generator</a></li>                
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<header>
  <h1>Audiobooks</h1>
  <p>Discover a curated selection of audiobooks from multiple public sources.</p>
</header>

<div class="filters">
  <input type="text" id="searchBar" placeholder="Search audiobooks..." />
  <select id="categoryFilter">
    <option value="">All Categories</option>
    <option value="literature">Literature</option>
    <option value="history">History</option>
    <option value="science">Science</option>
    <option value="philosophy">Philosophy</option>
    <option value="politics">Politics</option>
    <option value="economics">Economics</option>
  </select>
</div>

<div class="container my-4">
  <div class="row" id="audiobook-container"></div>
</div>

<div id="loading">Loading audiobooks...</div>

<footer class="bg-dark text-white py-4 mt-5">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
    <div class="mb-2 mb-md-0">
      <strong>Course Aggregator</strong> &nbsp;|&nbsp;
      <strong>Â© 2025 All rights reserved.</strong>
    </div>
    <div>
      <a href="../index.html" class="text-light text-decoration-none me-3">Home</a>
      <a href="contact.html" class="text-light text-decoration-none me-3">Contact</a>
      <a href="privacy.html" class="text-light text-decoration-none">Privacy</a>
    </div>
  </div>
</footer>

<script>
const container = document.getElementById('audiobook-container');
const searchBar = document.getElementById('searchBar');
const categoryFilter = document.getElementById('categoryFilter');
const loadingEl = document.getElementById('loading');

let allItems = [];
let isFetching = false;
let currentOffset = 0;
const limit = 12;

// Map category based on title
function mapCategory(title) {
  title = title.toLowerCase();
  if(title.includes('politics')) return 'politics';
  if(title.includes('economics') || title.includes('money')) return 'economics';
  if(title.includes('philosophy') || title.includes('meditation')) return 'philosophy';
  if(title.includes('science') || title.includes('physics') || title.includes('biology')) return 'science';
  if(title.includes('history') || title.includes('war')) return 'history';
  return 'literature';
}

// Render items
function renderItems(items) {
  container.innerHTML = '';
  if(items.length === 0) {
    container.innerHTML = '<div class="col-12 text-center text-muted">No results found.</div>';
    return;
  }
  items.forEach(item => {
    const col = document.createElement('div');
    col.className = 'col-12 col-md-4 col-lg-3 mb-4';
    col.innerHTML = `
      <div class="card h-100 shadow-sm">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${item.title}</h5>
          <p class="card-text mb-1">Author: ${item.authors}</p>
          <p class="text-muted small">Category: ${item.category}</p>
          <a href="${item.link}" target="_blank" class="mt-auto btn btn-primary btn-sm">Listen / Download</a>
        </div>
      </div>`;
    container.appendChild(col);
  });
}

// Fetch functions using public sources
async function fetchLibriVox(offset) {
  const url = `https://api.allorigins.win/get?url=${encodeURIComponent(`https://librivox.org/api/feed/audiobooks?format=json&limit=${limit}&offset=${offset}`)}`;
  const res = await fetch(url);
  const data = await res.json();
  const books = JSON.parse(data.contents).books;
  return books.map(b => ({
    title: b.title,
    authors: b.authors.length ? b.authors.map(a=>a.first_name+' '+a.last_name).join(', ') : 'Unknown',
    link: b.url_librivox,
    category: mapCategory(b.title)
  }));
}

async function fetchInternetArchive(offset) {
  const page = offset / limit + 1;
  const url = `https://archive.org/advancedsearch.php?q=mediatype:audiobook&rows=${limit}&page=${page}&output=json`;
  const res = await fetch(url);
  const data = await res.json();
  return data.response.docs.map(d => ({
    title: d.title || 'Unknown',
    authors: d.creator || 'Unknown',
    link: `https://archive.org/details/${d.identifier}`,
    category: mapCategory(d.title)
  }));
}

async function fetchOpenLibrary(offset) {
  const url = `https://openlibrary.org/subjects/audiobooks.json?limit=${limit}&offset=${offset}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.works.map(w => ({
    title: w.title,
    authors: w.authors.map(a=>a.name).join(', '),
    link: `https://openlibrary.org${w.key}`,
    category: 'literature'
  }));
}

// Load next batch
async function loadNextBatch() {
  if(isFetching) return;
  isFetching = true;
  loadingEl.style.display = 'block';

  const [lv, ia, ol] = await Promise.all([
    fetchLibriVox(currentOffset),
    fetchInternetArchive(currentOffset),
    fetchOpenLibrary(currentOffset)
  ]);

  const newItems = [...lv, ...ia, ...ol];
  // Remove duplicates by link
  const uniqueItems = newItems.filter(n => !allItems.some(a => a.link === n.link));
  allItems.push(...uniqueItems);
  applyFilters();

  currentOffset += limit;
  isFetching = false;
  loadingEl.style.display = 'none';
}

// Filter items
function applyFilters() {
  const query = searchBar.value.trim().toLowerCase();
  const category = categoryFilter.value.trim().toLowerCase();
  const filtered = allItems.filter(item =>
    item.title.toLowerCase().includes(query) &&
    (!category || item.category.toLowerCase().includes(category))
  );
  renderItems(filtered);
}

// Infinite scroll
window.addEventListener('scroll', () => {
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500) {
    loadNextBatch();
  }
});

searchBar.addEventListener('input', applyFilters);
categoryFilter.addEventListener('change', applyFilters);

// Initial load
loadNextBatch();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
