<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Infinite Scroll Book Aggregator</title>
<style>
body { font-family: Arial, sans-serif; background: #f9f9f9; margin: 20px; }
.search-bar, .category-filter { width: 100%; padding: 12px 16px; border-radius: 12px; border: 1px solid #ccc; margin-bottom: 16px; font-size: 16px; }
#course-container { display: grid; grid-template-columns: repeat(auto-fit, minmax(260px, 1fr)); gap: 24px; }
.book-card { background: white; border-radius: 16px; box-shadow: 0 4px 12px rgba(0,0,0,0.08); padding: 16px; transition: transform 0.2s ease, box-shadow 0.2s ease; }
.book-card:hover { transform: translateY(-4px); box-shadow: 0 8px 20px rgba(0,0,0,0.12); }
.book-card img { width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 12px; }
.book-card h3 { font-size: 18px; font-weight: 600; margin: 0 0 6px; color: #111; }
.book-card p { font-size: 14px; margin: 2px 0; color: #555; }
.book-card a { display: inline-block; margin-top: 8px; color: #1a73e8; font-weight: 500; text-decoration: none; }
.book-card a:hover { text-decoration: underline; }
#loading { text-align:center; margin-top:20px; font-weight:bold; color:#555; }
#progress { text-align:center; margin-top:8px; font-size:0.9em; color:#666; }
</style>
</head>
<body>

<header>
  <h1>Infinite Scroll Book Aggregator</h1>
  <p>Browse hundreds of books from multiple sources in real-time</p>
</header>

<input type="text" id="searchBar" placeholder="Search books..." class="search-bar" />
<select id="categoryFilter" class="category-filter">
  <option value="">All Categories</option>
  <option value="politics">Politics</option>
  <option value="economics">Economics</option>
  <option value="philosophy">Philosophy</option>
  <option value="science">Science</option>
  <option value="history">History</option>
  <option value="literature">Literature</option>
</select>

<div id="course-container"></div>
<div id="loading">Loading books...</div>
<div id="progress"></div>

<script>
const courseContainer = document.getElementById('course-container');
const searchBar = document.getElementById('searchBar');
const categoryFilter = document.getElementById('categoryFilter');
const loadingEl = document.getElementById('loading');

let allItems = [];
let filteredItems = [];
let isFetching = false;

// Track page for each source
let sourcePages = { gutenberg: 1, openlibrary: 1, internetarchive: 1 };

// --- Starter books
const starterBooks = [
  { title:"Pride and Prejudice", authors:"Jane Austen", link:"#", cover:"", type:"book", category:"literature" },
  { title:"The Republic", authors:"Plato", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Meditations", authors:"Marcus Aurelius", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Democracy in America", authors:"Alexis de Tocqueville", link:"#", cover:"", type:"book", category:"politics" },
  { title:"Economics Basics", authors:"John Doe", link:"#", cover:"", type:"book", category:"economics" },
  { title:"World History", authors:"Jane Smith", link:"#", cover:"", type:"book", category:"history" },
  { title:"History of Science", authors:"Robert Brown", link:"#", cover:"", type:"book", category:"science" }
];

// --- Map title to category
function mapTitleToCategory(title){
  title = title.toLowerCase();
  if(title.includes("politics") || title.includes("democracy")) return "politics";
  if(title.includes("economics") || title.includes("money")) return "economics";
  if(title.includes("philosophy") || title.includes("meditation")) return "philosophy";
  if(title.includes("science") || title.includes("physics") || title.includes("biology")) return "science";
  if(title.includes("history") || title.includes("war")) return "history";
  return "literature"; 
}

// --- Render items
function renderItems() {
  courseContainer.innerHTML = "";
  if(filteredItems.length === 0){
    courseContainer.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#777;">No results found.</p>`;
  }
  filteredItems.forEach(item=>{
    const card = document.createElement("div");
    card.className="book-card";
    card.innerHTML = `
      ${item.cover?`<img src="${item.cover}" alt="${item.title}">`:""}
      <h3>${item.title}</h3>
      <p>${item.type==="book"?"Author: "+item.authors:"Instructor: "+item.instructors}</p>
      <p style="font-size:12px;color:#888;">${item.category?("Category: "+item.category):("Source: "+item.source)}</p>
      <a href="${item.link}" target="_blank">${item.type==="book"?"Read / Borrow":"View Course"}</a>
    `;
    courseContainer.appendChild(card);
  });
}

// --- Apply filters
function applyFilters() {
  const query = searchBar.value.toLowerCase();
  const category = categoryFilter.value.toLowerCase();

  // Filter already loaded items
  filteredItems = allItems.filter(item=>{
    const matchesQuery = item.title.toLowerCase().includes(query);
    const matchesCategory = !category || (item.category && item.category.toLowerCase()===category);
    return matchesQuery && matchesCategory;
  });

  renderItems();

  // Reset pages and load first batch for new category
  sourcePages = { gutenberg: 1, openlibrary: 1, internetarchive: 1 };
  allItems = [...starterBooks];
  loadNextBatch(category);
}

// --- Fetch functions
async function fetchGutenberg(page=1, category=""){
  const topicQuery = category?`&topic=${encodeURIComponent(category)}`:"";
  const res = await fetch(`https://gutendex.com/books?page=${page}${topicQuery}`);
  const data = await res.json();
  return data.results.map(b=>({
    title: b.title,
    authors: b.authors.map(a=>a.name).join(", ") || "Unknown",
    link: b.formats["text/html"]||b.formats["application/epub+zip"]||"#",
    cover: "",
    type:"book",
    category: mapTitleToCategory(b.title)
  }));
}

async function fetchOpenLibrary(page=1, category=""){
  const res = await fetch(`https://openlibrary.org/search.json?q=the&limit=20&page=${page}`);
  const data = await res.json();
  return data.docs.map(b=>({
    title: b.title,
    authors: (b.author_name||["Unknown"]).join(", "),
    link: b.key?`https://openlibrary.org${b.key}`:"#",
    cover: b.cover_i?`https://covers.openlibrary.org/b/id/${b.cover_i}-M.jpg`:"",
    type:"book",
    category: mapTitleToCategory(b.title)
  }));
}

async function fetchInternetArchive(page=1, category=""){
  const res = await fetch(`https://archive.org/advancedsearch.php?q=mediatype:texts&fl[]=identifier,title,creator&rows=20&page=${page}&output=json`);
  const data = await res.json();
  return data.response.docs.map(d=>({
    title: d.title || "Unknown",
    authors: d.creator || "Unknown",
    link: `https://archive.org/details/${d.identifier}`,
    cover: "",
    type:"book",
    category: mapTitleToCategory(d.title)
  }));
}

// --- Load next batch
async function loadNextBatch(category="") {
  if(isFetching) return;
  isFetching = true;
  loadingEl.style.display="block";

  const [gutenberg, openlibrary, internetarchive] = await Promise.all([
    fetchGutenberg(sourcePages.gutenberg, category),
    fetchOpenLibrary(sourcePages.openlibrary, category),
    fetchInternetArchive(sourcePages.internetarchive, category)
  ]);

  sourcePages.gutenberg++;
  sourcePages.openlibrary++;
  sourcePages.internetarchive++;

  allItems.push(...gutenberg, ...openlibrary, ...internetarchive);
  applyFilters(); // reapply filters including category
  isFetching = false;
  loadingEl.style.display="none";
}

// --- Infinite scroll
window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
    loadNextBatch(categoryFilter.value.toLowerCase());
  }
});

// --- Initial load
allItems = [...starterBooks];
applyFilters();

searchBar.addEventListener("input", applyFilters);
categoryFilter.addEventListener("change", applyFilters);
</script>

</body>
</html>
