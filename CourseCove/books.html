<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Listings | CourseCove</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<link rel="stylesheet" href="css/style.css" />
<link rel="icon" type="image/png" href="images/favicon.png" />
<style>
  body { font-family: 'Inter', sans-serif; background-color: #f4f7fb; margin:0; padding: 1.5rem;}
  header { text-align:center; margin:20px 0; }
  header h1 { font-size:2.5rem; color:#333; margin:0; }
  header p { font-size:1.125rem; color:#666; }
  .filters { display:flex; justify-content:center; margin:20px 0; gap:20px; flex-wrap:wrap; }
  select, input[type="text"] { padding:10px; border-radius:8px; border:1px solid #ddd; font-size:1rem; width:200px; }
  #loading { text-align:center; margin:20px; color:#666; }
</style>
</head>
<body>

<nav class="navbar navbar-expand-lg" style="background-color: #e3e5e9;">
  <div class="container">
    <a class="navbar-brand" href="../index.html">
      <img src="images/logo1.png" alt="Course Aggregator Logo" style="height: 70px; width: auto;" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="math.html">Math</a></li>
        <li class="nav-item"><a class="nav-link" href="ai-ml.html">AI / ML</a></li>
        <li class="nav-item"><a class="nav-link" href="arts-humanities.html">Arts & Humanities</a></li>
        <li class="nav-item"><a class="nav-link" href="languages.html">Languages</a></li>
        <li class="nav-item"><a class="nav-link" href="politics-economics.html">Politics & Economics</a></li>
        <li class="nav-item"><a class="nav-link" href="environment.html">Environment</a></li>
        <li class="nav-item"><a class="nav-link" href="../blog.html">Blog</a></li>
        <li class="nav-item"><a class="nav-link active" href="#">Books</a></li>
        <li class="nav-item"><a class="nav-link active" href="articles.html">Articles</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<header>
  <h1>Book Listings</h1>
  <p>Discover a curated selection of books from multiple sources.</p>
</header>

<div class="filters">
  <input type="text" id="searchBar" placeholder="Search books..." />
  <select id="categoryFilter">
    <option value="">All Categories</option>
    <option value="politics">Politics</option>
    <option value="economics">Economics</option>
    <option value="philosophy">Philosophy</option>
    <option value="science">Science</option>
    <option value="history">History</option>
    <option value="literature">Literature</option>
  </select>
</div>

<div class="container my-4">
  <div class="row" id="course-container"></div>
</div>

<div id="loading">Loading books...</div>



<footer class="bg-dark text-white py-4 mt-5">
  <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center">
    <div class="mb-2 mb-md-0">
      <strong>Course Aggregator</strong> &nbsp;|&nbsp;
      <strong>Â© 2025 All rights reserved.</strong>
    </div>
    <div>
      <a href="../index.html" class="text-light text-decoration-none me-3">Home</a>
      <a href="contact.html" class="text-light text-decoration-none me-3">Contact</a>
      <a href="privacy.html" class="text-light text-decoration-none">Privacy</a>
    </div>
  </div>
</footer>

<script>
const courseContainer = document.getElementById('course-container');
const searchBar = document.getElementById('searchBar');
const categoryFilter = document.getElementById('categoryFilter');
const loadingEl = document.getElementById('loading');

let allItems = [];
let filteredItems = [];
let isFetching = false;
let sourcePages = { gutenberg: 1, openlibrary: 1, internetarchive: 1 };

const starterBooks = [
  { title:"Pride and Prejudice", authors:"Jane Austen", link:"#", cover:"", type:"book", category:"literature" },
  { title:"The Republic", authors:"Plato", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Meditations", authors:"Marcus Aurelius", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Democracy in America", authors:"Alexis de Tocqueville", link:"#", cover:"", type:"book", category:"politics" },
  { title:"Economics Basics", authors:"John Doe", link:"#", cover:"", type:"book", category:"economics" },
  { title:"World History", authors:"Jane Smith", link:"#", cover:"", type:"book", category:"history" },
  { title:"History of Science", authors:"Robert Brown", link:"#", cover:"", type:"book", category:"science" }
];

function mapTitleToCategory(title){
  title = title.toLowerCase();
  if(title.includes("politics") || title.includes("democracy")) return "politics";
  if(title.includes("economics") || title.includes("money")) return "economics";
  if(title.includes("philosophy") || title.includes("meditation")) return "philosophy";
  if(title.includes("science") || title.includes("physics") || title.includes("biology")) return "science";
  if(title.includes("history") || title.includes("war")) return "history";
  return "literature"; 
}

function renderItems(items) {
  courseContainer.innerHTML = "";
  if(items.length === 0){
    courseContainer.innerHTML = `<div class="col-12 text-center text-muted">No results found.</div>`;
    return;
  }
  items.forEach(item=>{
    const col = document.createElement("div");
    col.className = "col-12 col-md-4 col-lg-3 mb-4";
    col.innerHTML = `
      <div class="card h-100 shadow-sm">
        ${item.cover ? `<img src="${item.cover}" class="card-img-top" alt="${item.title}">` : ''}
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">${item.title}</h5>
          <p class="card-text mb-1">${item.type==="book"?"Author: "+item.authors:"Instructor: "+item.instructors}</p>
          <p class="text-muted small">${item.category?("Category: "+item.category):("Source: "+item.source)}</p>
          <a href="${item.link}" target="_blank" class="mt-auto btn btn-primary btn-sm">${item.type==="book"?"Read / Borrow":"View Course"}</a>
        </div>
      </div>`;
    courseContainer.appendChild(col);
  });
}

// ----------------- FETCH HELPERS -----------------

async function fetchGutenberg(query="", category="", page=1) {
  let url = `https://gutendex.com/books?page=${page}`;
  if (query) url += `&search=${encodeURIComponent(query)}`;
  if (category) url += `&topic=${encodeURIComponent(category)}`;
  const res = await fetch(url);
  const data = await res.json();
  return data.results.map(b=>({
    title: b.title,
    authors: b.authors.map(a=>a.name).join(", ") || "Unknown",
    link: b.formats["text/html"]||b.formats["application/epub+zip"]||"#",
    cover: "",
    type:"book",
    category: mapTitleToCategory(b.title),
    source:"Gutenberg"
  }));
}

async function fetchOpenLibrary(query="the", page=1){
  const res = await fetch(`https://openlibrary.org/search.json?q=${encodeURIComponent(query)}&limit=20&page=${page}`);
  const data = await res.json();
  return data.docs.map(b=>({
    title: b.title,
    authors: (b.author_name||["Unknown"]).join(", "),
    link: b.key?`https://openlibrary.org${b.key}`:"#",
    cover: b.cover_i?`https://covers.openlibrary.org/b/id/${b.cover_i}-M.jpg`:"",
    type:"book",
    category: mapTitleToCategory(b.title),
    source:"OpenLibrary"
  }));
}

async function fetchInternetArchive(query="", page=1){
  const q = query ? `${encodeURIComponent(query)}` : "mediatype:texts";
  const res = await fetch(`https://archive.org/advancedsearch.php?q=${q}+AND+mediatype:texts&fl[]=identifier,title,creator&rows=20&page=${page}&output=json`);
  const data = await res.json();
  return data.response.docs.map(d=>({
    title: d.title || "Unknown",
    authors: d.creator || "Unknown",
    link: `https://archive.org/details/${d.identifier}`,
    cover: "",
    type:"book",
    category: mapTitleToCategory(d.title),
    source:"InternetArchive"
  }));
}

// ----------------- CORE -----------------

async function applyFilters() {
  const query = searchBar.value.trim().toLowerCase();
  const category = categoryFilter.value.toLowerCase();

  // Step 1: local search
  const localMatches = allItems.filter(item =>
    item.title.toLowerCase().includes(query) &&
    (!category || (item.category && item.category.toLowerCase() === category))
  );

  if (localMatches.length > 0 || !query) {
    renderItems(localMatches);
    return;
  }

  // Step 2: external fetch (if no local match)
  loadingEl.style.display = "block";
  const [gutenberg, openlibrary, internetarchive] = await Promise.all([
    fetchGutenberg(query, category),
    fetchOpenLibrary(query),
    fetchInternetArchive(query)
  ]);
  const externalResults = [...gutenberg, ...openlibrary, ...internetarchive];
  renderItems(externalResults);
  loadingEl.style.display = "none";
}

async function loadNextBatch(category="") {
  if(isFetching) return;
  isFetching = true;
  loadingEl.style.display = "block";

  const [gutenberg, openlibrary, internetarchive] = await Promise.all([
    fetchGutenberg("", category, sourcePages.gutenberg),
    fetchOpenLibrary("the", sourcePages.openlibrary),
    fetchInternetArchive("", sourcePages.internetarchive)
  ]);
  sourcePages.gutenberg++;
  sourcePages.openlibrary++;
  sourcePages.internetarchive++;

  const newItems = [...gutenberg, ...openlibrary, ...internetarchive];
  allItems.push(...newItems);
  renderItems(allItems);

  isFetching = false;
  loadingEl.style.display = "none";
}

// ----------------- INIT -----------------

window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
    loadNextBatch(categoryFilter.value.toLowerCase());
  }
});

allItems = [...starterBooks];
renderItems(allItems);

searchBar.addEventListener("input", applyFilters);
categoryFilter.addEventListener("change", applyFilters);
</script>


<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
  
</html>
