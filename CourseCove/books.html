<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Book Aggregator | CourseCove Style</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
   <link rel="stylesheet" href="css/style.css" />
    <link rel="icon" type="image/png" href="images/favicon.png" />
<style>
  body { font-family: 'Inter', sans-serif; background-color: #f4f7fb; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; }
  header { text-align:center; margin:20px 0; }
  header h1 { font-size:2.5rem; color:#333; margin:0; }
  header p { font-size:1.125rem; color:#666; }
  .filters { display:flex; justify-content:center; margin:20px 0; gap:20px; flex-wrap:wrap; }
  select, input[type="text"] { padding:10px; border-radius:8px; border:1px solid #ddd; font-size:1rem; width:200px; }
  #course-container { display:grid; grid-template-columns:repeat(auto-fill, minmax(250px, 1fr)); gap:20px; padding:20px; width:80%; max-width:1200px; }
  .book-card { background:white; border-radius:12px; box-shadow:0 4px 12px rgba(0,0,0,0.1); overflow:hidden; transition:transform 0.3s ease, box-shadow 0.3s ease; }
  .book-card:hover { transform:translateY(-4px); box-shadow:0 6px 18px rgba(0,0,0,0.15); }
  .book-card img { width:100%; height:180px; object-fit:cover; }
  .book-card .content { padding:15px; }
  .book-card h3 { font-size:1.25rem; margin:10px 0; color:#333; }
  .book-card p { font-size:0.875rem; color:#777; margin:5px 0; }
  .book-card a { display:inline-block; margin-top:10px; color:#007bff; text-decoration:none; font-weight:600; }
  .book-card a:hover { text-decoration:underline; }
  #loading { text-align:center; margin:20px; color:#666; }
</style>
</head>
<body>


  <nav class="navbar navbar-expand-lg" style="background-color: #e3e5e9;">
  <div class="container">
    <a class="navbar-brand" href="../index.html">
      <img src="images/logo1.png" alt="Course Aggregator Logo" style="height: 70px; width: auto;" />
    </a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav"
      aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon" style="filter: invert(1);"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="../index.html">Home</a></li>
        <li class="nav-item"><a class="nav-link active" href="math.html">Math</a></li>
        <li class="nav-item"><a class="nav-link " href="ai-ml.html">AI / ML</a></li>
        <li class="nav-item"><a class="nav-link" href="arts-humanities.html">Arts & Humanities</a></li>
        <li class="nav-item"><a class="nav-link" href="languages.html">Languages</a></li>
        <li class="nav-item"><a class="nav-link" href="politics-economics.html">Politics & Economics</a></li>
        <li class="nav-item"><a class="nav-link" href="environment.html">Environment</a></li>
        <li class="nav-item"><a class="nav-link" href="../blog.html">Blog</a></li>
        <li class="nav-item"><a class="nav-link" href="contact.html">Contact</a></li>
      </ul>
    </div>
  </div>
</nav>

<div class="filters">
  <input type="text" id="searchBar" placeholder="Search books..." />
  <select id="categoryFilter">
    <option value="">All Categories</option>
    <option value="politics">Politics</option>
    <option value="economics">Economics</option>
    <option value="philosophy">Philosophy</option>
    <option value="science">Science</option>
    <option value="history">History</option>
    <option value="literature">Literature</option>
  </select>
</div>

<div id="course-container"></div>
<div id="loading">Loading books...</div>

<script>
const courseContainer = document.getElementById('course-container');
const searchBar = document.getElementById('searchBar');
const categoryFilter = document.getElementById('categoryFilter');
const loadingEl = document.getElementById('loading');

let allItems = [];
let filteredItems = [];
let isFetching = false;
let sourcePages = { gutenberg: 1, openlibrary: 1, internetarchive: 1 };
const categoryCache = {}; // store fetched items per category

// Starter books
const starterBooks = [
  { title:"Pride and Prejudice", authors:"Jane Austen", link:"#", cover:"", type:"book", category:"literature" },
  { title:"The Republic", authors:"Plato", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Meditations", authors:"Marcus Aurelius", link:"#", cover:"", type:"book", category:"philosophy" },
  { title:"Democracy in America", authors:"Alexis de Tocqueville", link:"#", cover:"", type:"book", category:"politics" },
  { title:"Economics Basics", authors:"John Doe", link:"#", cover:"", type:"book", category:"economics" },
  { title:"World History", authors:"Jane Smith", link:"#", cover:"", type:"book", category:"history" },
  { title:"History of Science", authors:"Robert Brown", link:"#", cover:"", type:"book", category:"science" }
];

// Map title to category
function mapTitleToCategory(title){
  title = title.toLowerCase();
  if(title.includes("politics") || title.includes("democracy")) return "politics";
  if(title.includes("economics") || title.includes("money")) return "economics";
  if(title.includes("philosophy") || title.includes("meditation")) return "philosophy";
  if(title.includes("science") || title.includes("physics") || title.includes("biology")) return "science";
  if(title.includes("history") || title.includes("war")) return "history";
  return "literature"; 
}

// Render items
function renderItems() {
  courseContainer.innerHTML = "";
  if(filteredItems.length === 0){
    courseContainer.innerHTML = `<p style="grid-column:1/-1;text-align:center;color:#777;">No results found.</p>`;
  }
  filteredItems.forEach(item=>{
    const card = document.createElement("div");
    card.className="book-card";
    card.innerHTML = `
      ${item.cover?`<img src="${item.cover}" alt="${item.title}">`:""}
      <div class="content">
        <h3>${item.title}</h3>
        <p>${item.type==="book"?"Author: "+item.authors:"Instructor: "+item.instructors}</p>
        <p style="font-size:12px;color:#888;">${item.category?("Category: "+item.category):("Source: "+item.source)}</p>
        <a href="${item.link}" target="_blank">${item.type==="book"?"Read / Borrow":"View Course"}</a>
      </div>
    `;
    courseContainer.appendChild(card);
  });
}

// Apply filters
function applyFilters() {
  const query = searchBar.value.toLowerCase();
  const category = categoryFilter.value.toLowerCase();

  // Filter the books already in memory
  filteredItems = allItems.filter(item => {
    const matchesQuery = item.title.toLowerCase().includes(query);
    const matchesCategory = !category || (item.category && item.category.toLowerCase() === category);
    return matchesQuery && matchesCategory;
  });

  renderItems(); // show results immediately

  // If category already cached, just use it
  if(category && categoryCache[category]){
    allItems = [...starterBooks, ...categoryCache[category]];
    filteredItems = allItems.filter(item => !category || item.category.toLowerCase() === category);
    renderItems();
    return;
  }

  // Fetch more in background
  loadNextBatch(category);
}

// Fetch functions
async function fetchGutenberg(page=1, category=""){
  const topicQuery = category?`&topic=${encodeURIComponent(category)}`:"";
  const res = await fetch(`https://gutendex.com/books?page=${page}${topicQuery}`);
  const data = await res.json();
  return data.results.map(b=>({
    title: b.title,
    authors: b.authors.map(a=>a.name).join(", ") || "Unknown",
    link: b.formats["text/html"]||b.formats["application/epub+zip"]||"#",
    cover: "",
    type:"book",
    category: mapTitleToCategory(b.title)
  }));
}

async function fetchOpenLibrary(page=1){
  const res = await fetch(`https://openlibrary.org/search.json?q=the&limit=20&page=${page}`);
  const data = await res.json();
  return data.docs.map(b=>({
    title: b.title,
    authors: (b.author_name||["Unknown"]).join(", "),
    link: b.key?`https://openlibrary.org${b.key}`:"#",
    cover: b.cover_i?`https://covers.openlibrary.org/b/id/${b.cover_i}-M.jpg`:"",
    type:"book",
    category: mapTitleToCategory(b.title)
  }));
}

async function fetchInternetArchive(page=1){
  const res = await fetch(`https://archive.org/advancedsearch.php?q=mediatype:texts&fl[]=identifier,title,creator&rows=20&page=${page}&output=json`);
  const data = await res.json();
  return data.response.docs.map(d=>({
    title: d.title || "Unknown",
    authors: d.creator || "Unknown",
    link: `https://archive.org/details/${d.identifier}`,
    cover: "",
    type:"book",
    category: mapTitleToCategory(d.title)
  }));
}

// Load next batch
async function loadNextBatch(category="") {
  if(isFetching) return;
  isFetching = true;
  loadingEl.style.display = "block";

  const [gutenberg, openlibrary, internetarchive] = await Promise.all([
    fetchGutenberg(sourcePages.gutenberg, category),
    fetchOpenLibrary(sourcePages.openlibrary),
    fetchInternetArchive(sourcePages.internetarchive)
  ]);

  sourcePages.gutenberg++;
  sourcePages.openlibrary++;
  sourcePages.internetarchive++;

  const newItems = [...gutenberg, ...openlibrary, ...internetarchive];

  // Cache by category
  if(category) categoryCache[category] = newItems;

  allItems.push(...newItems);

  const query = searchBar.value.toLowerCase();
  filteredItems = allItems.filter(item => {
    const matchesQuery = item.title.toLowerCase().includes(query);
    const matchesCategory = !category || (item.category && item.category.toLowerCase() === category);
    return matchesQuery && matchesCategory;
  });

  renderItems();
  isFetching = false;
  loadingEl.style.display = "none";
}

// Infinite scroll
window.addEventListener("scroll", ()=>{
  if(window.innerHeight + window.scrollY >= document.body.offsetHeight - 500){
    loadNextBatch(categoryFilter.value.toLowerCase());
  }
});

// Initial load
allItems = [...starterBooks];
applyFilters();

searchBar.addEventListener("input", applyFilters);
categoryFilter.addEventListener("change", applyFilters);
</script>

</body>
</html>
